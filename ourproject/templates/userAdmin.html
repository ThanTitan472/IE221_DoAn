{% extends 'project/base.html' %}
{% load static %}
{% block user-content %}

<div class="user-table-container">
        <div class="header-for-overview">

        <h3>Danh sách người dùng</h3>
        <a href="user/create" class="btn-add-data">Thêm người dùng</a>
        </div>
        <table class="user-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Tên</th>
                    <th>Email</th>
                    <th>Tuổi</th>
                    <th>Trạng thái</th>
                    <th>Hành động</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1</td>
                    <td>Nguyễn Văn A</td>
                    <td>a.nguyen@example.com</td>
                    <td>25</td>
                    <td>Hoạt động</td>
                    <td>
                        <button class="edit-btn">Sửa</button>
                        <button class="delete-btn">Xóa</button>
                    </td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>Trần Thị B</td>
                    <td>b.tran@example.com</td>
                    <td>30</td>
                    <td>Ngừng hoạt động</td>
                    <td>
                        <button class="edit-btn">Sửa</button>
                        <button class="delete-btn">Xóa</button>
                    </td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>Phạm Văn C</td>
                    <td>c.pham@example.com</td>
                    <td>28</td>
                    <td>Hoạt động</td>
                    <td>
                        <button class="edit-btn">Sửa</button>
                        <button class="delete-btn">Xóa</button>
                    </td>
                </tr>
            </tbody>
        </table>
        <form id="edit-form" class="hidden">
        <h4>Chỉnh sửa thông tin người dùng</h4>
        <div>
            <label for="edit-id">ID:</label>
            <input type="text" id="edit-id" name="id" readonly>
        </div>
        <div>
            <label for="edit-name">Tên:</label>
            <input type="text" id="edit-name" name="name" required>
        </div>
        <div>
            <label for="edit-email">Email:</label>
            <input type="email" id="edit-email" name="email" required>
        </div>
        <div>
            <label for="edit-age">Tuổi:</label>
            <input type="number" id="edit-age" name="age" required>
        </div>
        <div>
            <label for="edit-status">Trạng thái:</label>
            <select id="edit-status" name="status">
                <option value="Hoạt động">Hoạt động</option>
                <option value="Ngừng hoạt động">Ngừng hoạt động</option>
            </select>
        </div>
        <button type="submit">Lưu</button>
        <button type="button" id="cancel-btn">Hủy</button>
    </form>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const editForm = document.getElementById('edit-form');
    const cancelBtn = document.getElementById('cancel-btn');
    const editIdInput = document.getElementById('edit-id');
    const editNameInput = document.getElementById('edit-name');
    const editEmailInput = document.getElementById('edit-email');
    const editAgeInput = document.getElementById('edit-age');
    const editStatusSelect = document.getElementById('edit-status');

    // Xử lý khi nhấn nút "Sửa"
    document.querySelectorAll('.edit-btn').forEach((button) => {
        button.addEventListener('click', (e) => {
            const row = e.target.closest('tr'); // Lấy hàng (row) hiện tại
            const cells = row.querySelectorAll('td'); // Lấy tất cả các ô trong hàng

            // Điền dữ liệu từ hàng vào form
            editIdInput.value = row.querySelector('td:first-child').innerText;
            editNameInput.value = cells[1].innerText;
            editEmailInput.value = cells[2].innerText;
            editAgeInput.value = cells[3].innerText;
            editStatusSelect.value = cells[4].innerText;

            // Hiển thị form
            editForm.classList.remove('hidden');

            // Gắn hàng hiện tại vào thuộc tính data-row để lưu trữ
            editForm.dataset.row = row.rowIndex;
        });
    });

    // Xử lý khi nhấn nút "Hủy"
    cancelBtn.addEventListener('click', () => {
        editForm.classList.add('hidden');
        editForm.removeAttribute('data-row');
    });

    // Xử lý khi lưu form
    editForm.addEventListener('submit', (e) => {
        e.preventDefault(); // Ngăn chặn hành vi submit mặc định

        // Lấy dữ liệu từ form
        const updatedId = editIdInput.value;
        const updatedName = editNameInput.value;
        const updatedEmail = editEmailInput.value;
        const updatedAge = editAgeInput.value;
        const updatedStatus = editStatusSelect.value;

        // Tìm hàng tương ứng và cập nhật giá trị
        const rowIndex = editForm.dataset.row;
        const table = document.querySelector('.user-table tbody');
        const row = table.rows[rowIndex - 1]; // -1 vì rowIndex bắt đầu từ 1
        const cells = row.querySelectorAll('td');

        cells[0].innerText = updatedId;
        cells[1].innerText = updatedName;
        cells[2].innerText = updatedEmail;
        cells[3].innerText = updatedAge;
        cells[4].innerText = updatedStatus;

        // Ẩn form sau khi lưu
        editForm.classList.add('hidden');
        editForm.removeAttribute('data-row');
    });

    // Xử lý khi nhấn nút "Xóa"
    document.querySelectorAll('.delete-btn').forEach((button) => {
        button.addEventListener('click', (e) => {
            const row = e.target.closest('tr'); // Lấy hàng cần xóa
            const table = document.querySelector('.user-table tbody');

            // Xác nhận trước khi xóa
            const confirmDelete = confirm('Bạn có chắc chắn muốn xóa người dùng này không?');
            if (confirmDelete) {
                table.removeChild(row); // Xóa hàng khỏi bảng
            }
        });
    });
});
</script>